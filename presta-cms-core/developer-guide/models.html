<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>PrestaCMS Advanced block</title>

    <meta name="author" content="" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="canonical" href="../../presta-cms-core/developer-guide/models.html" />
    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
    <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->

    <link href="../../assets/theme/css/main.css?version=20130731" rel="stylesheet" type="text/css" media="all">
    <link href="../../assets/theme/css/base_syntax.css?version=20130731" rel="stylesheet" type="text/css" media="all">

    <link rel="shortcut icon" href="../../assets/img/favicon.ico">

    <!-- atom & rss feed -->
    <!--<link href="" type="application/atom+xml" rel="alternate" title="Sitewide ATOM Feed">-->
    <!--<link href="" type="application/rss+xml" rel="alternate" title="Sitewide RSS Feed">-->

    <link href='http://fonts.googleapis.com/css?family=Reenie+Beanie|Open+Sans:300italic,400,300' rel='stylesheet' type='text/css'>
    <link href='http://fonts.googleapis.com/css?family=Open+Sans:300italic,300' rel='stylesheet' type='text/css'>
</head>

    <body>
        <header class="navbar navbar-default navbar-presta-top navbar-fixed-top" role="navigation">
            <div class="container">
                <div class="navbar-header">
                    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                        <span class="sr-only">Toggle navigation</span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                    <a class="navbar-brand brand" href="../../index.html" title="Symfony2 Expert">Prestaconcept</a>
                    <a class="ribbon" href="https://github.com/prestaconcept"><img src="https://s3.amazonaws.com/github/ribbons/forkme_right_green_007200.png" alt="Fork me on Github"></a>
                </div>
                <div class="collapse navbar-collapse">
                    <ul class="nav navbar-nav navbar-right">
                        <!-- Dropdown -->
                        <li class="dropdown">
                            <a href="#" class="dropdown-toggle" data-toggle="dropdown">Our Bundles <b class="caret"></b></a>
                            <ul class="dropdown-menu">




                                        <li><a href="https://github.com/prestaconcept/PrestaSitemapBundle/blob/master/README.md">PrestaSitemapBundle</a></li>

                                        <li><a href="https://github.com/prestaconcept/PrestaComposerPublicBundle/blob/master/README.md">PrestaComposerPublicBundle</a></li>




                                        <li class="divider"></li>


                                        <li><a href="../../presta-cms-core/index.html">PrestaCMSCoreBundle</a></li>

                                        <li><a href="https://github.com/prestaconcept/PrestaCMSCKEditorBundle/blob/master/README.md">PrestaCMSCKEditorBundle</a></li>

                                        <li><a href="../../presta-cms-contact/index.html">PrestaCMSContactBundle</a></li>

                                        <li><a href="https://github.com/prestaconcept/PrestaCMSFAQBundle/blob/master/README.md">PrestaCMSFAQBundle</a></li>

                                        <li><a href="../../presta-cms-media/index.html">PrestaCMSMediaBundle</a></li>

                                        <li><a href="https://github.com/prestaconcept/PrestaCMSSitemapBridgeBundle/blob/master/README.md">PrestaCMSSitemapBridgeBundle</a></li>

                                        <li><a href="../../presta-cms-social/index.html">PrestaCMSSocialBundle</a></li>

                                        <li><a href="../../presta-cms-theme/index.html">PrestaCMSThemeBasicBundle</a></li>

                                        <li><a href="https://github.com/prestaconcept/PrestaCMSUserBundle/blob/master/README.md">PrestaCMSUserBundle</a></li>




                                        <li class="divider"></li>


                                        <li><a href="https://github.com/prestaconcept/PrestaSonataAdminExtendedBundle/blob/master/README.md">PrestaSonataAdminExtendedBundle</a></li>

                                        <li><a href="https://github.com/prestaconcept/PrestaSonataGedmoDoctrineExtensionsBundle/blob/master/README.md">PrestaSonataGedmoDoctrineExtensionsBundle</a></li>

                                        <li><a href="../../presta-sonata-navigation/index.html">PrestaSonataNavigationBundle</a></li>


                            </ul>
                        </li>
                        <li class=""><a href="http://www.prestaconcept.net">Contact US</a></li>
                    </ul>
                </div>
            </div>
        </header>

        <div id="hook-outer">
    <div id="subheader" class="container">
        <h1>PrestaCMS Advanced block <small>- Working with models</small></h1>
    </div>
</div>

<div class="container">
    <div class="row">
        <div class="col-md-3">
            <div class="sidebar hidden-print" role="complementary">

                <ul class="nav">


                        <li >

                                <a href="../../presta-cms-core/index.html#content" ><i class="icon-chevron-right"></i> Overview</a>

                            <ul class="nav">

                                    <li >

                                        <a href="../../presta-cms-core/index.html#content" >Overview</a>

                                    </li>

                                    <li >

                                        <a href="../../presta-cms-core/features.html#content" >Features</a>

                                    </li>

                                    <li >

                                        <a href="../../presta-cms-core/our-philosophy.html#content" >Our philosophy</a>

                                    </li>

                                    <li >

                                        <a href="../../presta-cms-core/technologies.html#content" >Technologies</a>

                                    </li>

                                    <li >

                                        <a href="../../presta-cms-core/help-support.html#content" >Help & Support</a>

                                    </li>

                                    <li >

                                        <a href="../../presta-cms-core/release-process.html#content" >Release Process</a>

                                    </li>

                                    <li >

                                        <a href="../../presta-cms-core/extensions.html#content" >Extensions</a>

                                    </li>

                                    <li >

                                        <a href="../../presta-cms-core/showcases.html#content" >Showcases</a>

                                    </li>

                                    <li >

                                        <a href="../../presta-cms-core/statistics.html#content" >Statistics</a>

                                    </li>

                                    <li >

                                        <a href="../../presta-cms-core/contributing.html#content" >Contributing</a>

                                    </li>

                                    <li >

                                        <a href="../../presta-cms-core/faq.html#content" >FAQ</a>

                                    </li>

                            </ul>
                        </li>

                        <li class="active">

                                <a href="../../presta-cms-core/developer-guide/index.html#content" ><i class="icon-chevron-right"></i> Developer guide</a>

                            <ul class="nav">

                                    <li >

                                        <a href="../../presta-cms-core/developer-guide/installation.html#content" >Installation</a>

                                    </li>

                                    <li >

                                        <a href="../../presta-cms-core/developer-guide/getting-started.html#content" >Getting started</a>

                                    </li>

                                    <li >

                                        <a href="../../presta-cms-core/developer-guide/block.html#content" >Block System</a>

                                    </li>

                                    <li class="active">

                                        <a href="../../presta-cms-core/developer-guide/models.html#content" >Working with models</a>

                                    </li>

                                    <li >

                                        <a href="../../presta-cms-core/developer-guide/fixtures.html#content" >Fixtures</a>

                                    </li>

                                    <li >

                                        <a href="../../presta-cms-core/developer-guide/page.html#content" >Page types</a>

                                    </li>

                                    <li >

                                        <a href="../../presta-cms-core/developer-guide/custom-controller.html#content" >Custom controller</a>

                                    </li>

                                    <li >

                                        <a href="../../presta-cms-core/developer-guide/extending.html#content" >Extending PrestaCMS</a>

                                    </li>

                                    <li >

                                        <a href="../../presta-cms-core/developer-guide/docs.html#content" >Useful documentation</a>

                                    </li>

                            </ul>
                        </li>

                        <li >

                                <a href="../../presta-cms-core/user-guide/index.html#content" ><i class="icon-chevron-right"></i> User guide</a>

                            <ul class="nav">

                                    <li >

                                        <a href="../../presta-cms-core/user-guide/getting-started.html#content" >Getting started</a>

                                    </li>

                                    <li >

                                        <a href="../../presta-cms-core/user-guide/website.html#content" >Website</a>

                                    </li>

                                    <li >

                                        <a href="../../presta-cms-core/user-guide/theme.html#content" >Theme</a>

                                    </li>

                                    <li >

                                        <a href="../../presta-cms-core/user-guide/page.html#content" >Page</a>

                                    </li>

                                    <li >

                                        <a href="../../presta-cms-core/user-guide/block.html#content" >Block</a>

                                    </li>

                            </ul>
                        </li>

                        <li >

                                <a href="../../presta-cms-core/theming-guide/index.html#content" ><i class="icon-chevron-right"></i> Theming guide</a>

                            <ul class="nav">

                                    <li >

                                        <a href="../../presta-cms-core/theming-guide/getting-started.html#content" >Getting started</a>

                                    </li>

                                    <li >

                                        <a href="../../presta-cms-core/theming-guide/structure.html#content" >Theme structure</a>

                                    </li>

                                    <li >

                                        <a href="../../presta-cms-core/theming-guide/admin.html#content" >Administration features</a>

                                    </li>

                                    <li >

                                        <a href="../../presta-cms-core/theming-guide/showcase.html#content" >Showcase</a>

                                    </li>

                            </ul>
                        </li>


                </ul>

            </div>
        </div>
        <div class="col-md-9" role="main">
            <div class="section"><h2 id='overview'>Overview</h2>

<p>In the <a href='/presta-cms-core/developer-guide/block.html#content'>previous section</a> you learnt how to make simple blocks.</p>

<p>Now for a professional website you will quickly need to go a step further and add other kind of thing like :</p>

<ul>
<li>media</li>

<li>description of a product entity</li>

<li>picture of a user in a comment block - &#8230;</li>
</ul>

<p>So you need a way to link your block to your custom models.</p>

<h2 id='orm_models'>ORM Models</h2>

<p>To make your life easier we add a useful base class <a href='https://github.com/prestaconcept/PrestaCMSCoreBundle/blob/master/Block/BaseModelBlockService.php'>BaseModelBlockService</a> to add useful methods to handle models.</p>

<p>All you need to do is to extends this base class and to override <em>getModelFields()</em> method.</p>

<p>Let&#8217;s say we want to add a link to a media, stored with Sonata Media. Our block <em>getModelFields()</em> method will look like this :</p>
<div class='highlight'><pre><code class='php'><span class='cp'>&lt;?php</span>
<span class='k'>class</span> <span class='nc'>MyBlockService</span> <span class='k'>extends</span> <span class='nx'>BaseModelBlockService</span>
<span class='p'>{</span>
    <span class='sd'>/**</span>
<span class='sd'>     * {@inheritdoc}</span>
<span class='sd'>     */</span>
    <span class='k'>protected</span> <span class='k'>function</span> <span class='nf'>getModelFields</span><span class='p'>()</span>
    <span class='p'>{</span>
        <span class='k'>return</span> <span class='k'>array</span><span class='p'>(</span>
            <span class='s1'>&#39;media&#39;</span> <span class='o'>=&gt;</span> <span class='s1'>&#39;sonata.media.admin.media&#39;</span>
        <span class='p'>);</span>
    <span class='p'>}</span>

    <span class='sd'>/**</span>
<span class='sd'>     * {@inheritdoc}</span>
<span class='sd'>     */</span>
    <span class='k'>public</span> <span class='k'>function</span> <span class='nf'>getDefaultSettings</span><span class='p'>()</span>
    <span class='p'>{</span>
        <span class='k'>return</span> <span class='k'>array</span><span class='p'>(</span>
            <span class='s1'>&#39;media&#39;</span>  <span class='o'>=&gt;</span> <span class='k'>null</span>
        <span class='p'>);</span>
    <span class='p'>}</span>
<span class='p'>}</span>
</code></pre></div>
<p>Now you can use it in your template like this :</p>
<div class='highlight'><pre><code class='html'>{% extends &#39;PrestaCMSCoreBundle:Block:base_block.html.twig&#39; %}

{% block block %}
    {% if (settings.media) %}
        <span class='nt'>&lt;div</span> <span class='na'>class=</span><span class='s'>&quot;cms-block-media-container&quot;</span><span class='nt'>&gt;</span>
            {% media settings.media, small %}
        <span class='nt'>&lt;/div&gt;</span>
    {% endif %}
{% endblock %}
</code></pre></div>
<h2 id='content_models'>Content Models</h2>

<p>To link your blocks to content store in PHPCR will be as easy as the previous one.</p>

<p>We just have another method to use : <em>getContentModelFields()</em></p>

<p>Let&#8217;s say you want to add a link to a page stored in PrestaCMS. Your block will look like this :</p>
<div class='highlight'><pre><code class='php'><span class='cp'>&lt;?php</span>

<span class='k'>class</span> <span class='nc'>MyBlockService</span> <span class='k'>extends</span> <span class='nx'>BaseModelBlockService</span>
<span class='p'>{</span>
    <span class='sd'>/**</span>
<span class='sd'>     * {@inheritdoc}</span>
<span class='sd'>     */</span>
    <span class='k'>protected</span> <span class='k'>function</span> <span class='nf'>getContentModelFields</span><span class='p'>()</span>
    <span class='p'>{</span>
        <span class='k'>return</span> <span class='k'>array</span><span class='p'>(</span><span class='s1'>&#39;link_destination&#39;</span> <span class='o'>=&gt;</span> <span class='s1'>&#39;presta_cms.admin.page&#39;</span><span class='p'>);</span>
    <span class='p'>}</span>

    <span class='sd'>/**</span>
<span class='sd'>     * {@inheritdoc}</span>
<span class='sd'>     */</span>
    <span class='k'>public</span> <span class='k'>function</span> <span class='nf'>getDefaultSettings</span><span class='p'>()</span>
    <span class='p'>{</span>
        <span class='k'>return</span> <span class='k'>array</span><span class='p'>(</span>
            <span class='s1'>&#39;link_destination&#39;</span>  <span class='o'>=&gt;</span> <span class='k'>null</span>
        <span class='p'>);</span>
    <span class='p'>}</span>
<span class='p'>}</span>
</code></pre></div>
<p>Now you can use it in your template like this :</p>
<div class='highlight'><pre><code class='html'>{ % if (settings.link_destination|length) % }
    <span class='nt'>&lt;div</span> <span class='na'>class=</span><span class='s'>&quot;cms-block-link-container&quot;</span><span class='nt'>&gt;</span>
        <span class='nt'>&lt;a</span> <span class='na'>href=</span><span class='s'>&quot;{ % if (block.isAdminMode) % }#{ % else % }{ % endif % }&quot;</span><span class='nt'>&gt;</span>
            My link to a page
        <span class='nt'>&lt;/a&gt;</span>
    <span class='nt'>&lt;/div&gt;</span>
{ % endif % }
</code></pre></div>
<p>This example also show you how to use the <em>block.isAdminMode</em> method.</p>

<p>As block will be rendered in the administration website, we don&#8217;t want have multiple link to the front on page edition.</p>

<p>Usually this lost administrator easily so we just remove the real links in admin mode.</p>

<h2 id='declaration_of_a_model_block'>Declaration of a model block</h2>

<p>Model blocks declaration only differs on the parent attribute. Parent should be set to &#8220;presta_cms.block.model.base&#8221; which set the admin pool.</p>
<div class='highlight'><pre><code class='xml'><span class='nt'>&lt;container</span> <span class='na'>xmlns=</span><span class='s'>&quot;http://symfony.com/schema/dic/services&quot;</span>
       <span class='na'>xmlns:xsi=</span><span class='s'>&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
       <span class='na'>xsi:schemaLocation=</span><span class='s'>&quot;http://symfony.com/schema/dic/services http://symfony.com/schema/dic/services/services-1.0.xsd&quot;</span><span class='nt'>&gt;</span>

    <span class='nt'>&lt;parameters&gt;</span>
        <span class='nt'>&lt;parameter</span> <span class='na'>key=</span><span class='s'>&quot;presta_cms.block.list.class&quot;</span><span class='nt'>&gt;</span>Presta\CMSMediaBundle\Block\ListBlockService<span class='nt'>&lt;/parameter&gt;</span>
    <span class='nt'>&lt;/parameters&gt;</span>

    <span class='nt'>&lt;services&gt;</span>
        <span class='nt'>&lt;service</span> <span class='na'>id=</span><span class='s'>&quot;presta_cms.block.list&quot;</span> <span class='na'>class=</span><span class='s'>&quot;%presta_cms.block.list.class%&quot;</span> <span class='na'>parent=</span><span class='s'>&quot;presta_cms.block.parent.base&quot;</span><span class='nt'>&gt;</span>
            <span class='nt'>&lt;tag</span> <span class='na'>name=</span><span class='s'>&quot;sonata.block&quot;</span><span class='nt'>/&gt;</span>
            <span class='nt'>&lt;tag</span> <span class='na'>name=</span><span class='s'>&quot;presta_cms.block&quot;</span><span class='nt'>/&gt;</span>
        <span class='nt'>&lt;/service&gt;</span>
    <span class='nt'>&lt;/services&gt;</span>
<span class='nt'>&lt;/container&gt;</span>
</code></pre></div><hr />
<p>Congratulation, now you&#8217;re mastering block system.</p>

<p>&#8594; Let&#8217;s go deeper and <a href='/presta-cms-core/developer-guide/page.html#content'>discovering Pages</a>.</p>
</div>
        </div>
    </div>
</div>


        <footer>
            <div class="hire-us">
                <div class="container">
                    <div class="row">
                        <div class="col-lg-12">
                            <h2>Need Symfony2 developers for your next project</h2>
                            <a href="http://www.prestaconcept.net" class="btn btn-primary">
                                <i class="glyphicon glyphicon-hand-right"></i>&nbsp;Hire Us
                            </a>
                        </div>
                    </div>
                </div>
            </div>
            <div class="outer">
                <div class="container">
                    <div class="row">
                        <div class="col-lg-12">
                            <h2>PrestaConcept a Symfony2 developers company</h2>
                        </div>
                    </div>
                </div>
            </div>
            <div class="contact">
                <div class="container">
                    <div class="row">
                        <div class="col-sm-6">
                            <img id="footer-map" src="../../assets/theme/img/layout/footer-map.jpg" class="img-responsive img-rounded" />
                        </div>
                        <div class="col-sm-6">
                            <div class="contact-elements">
                                <a href="http://www.prestaconcept.net" class="brand">Prestaconcept</a>
                                <ul>
                                    <li><i class="glyphicon glyphicon-earphone"></i> +33 (0)4 78 54 45 45</li>
                                    <li><i class="glyphicon glyphicon-home"></i><a href="http://www.prestaconcept.net">www.prestaconcept.net</a></li>
                                    <li>
                                        <i class="glyphicon glyphicon-envelope"></i>5 impasse morel 69003 Lyon - FRANCE
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="copyright">
                <div class="container">
                    <div class="row">
                        <div class="col-lg-12">
                            Copyright &copy; Prestaconcept
                            &nbsp; <img src="https://d2weczhvl823v0.cloudfront.net/prestaconcept/prestaconcept.github.io/trend.png"/>
                        </div>
                    </div>
                </div>
            </div>

        </footer>

        <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
        <script src="https://code.jquery.com/jquery.js"></script>
        <!-- Include all compiled plugins (below), or include individual files as needed -->
        <script src="../../assets/theme/js/bootstrap.min.js"></script>
        <!-- Project file -->
        <script src="../../assets/theme/js/main.js"></script>


        <script>
            (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
                (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
                    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
            })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
            ga('create', 'UA-620827-11', 'prestaconcept.github.io');
            ga('send', 'pageview');
        </script>

    </body>
</html>
